<!DOCTYPE html>
<html>
<head>
    <title>Receive Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <link rel="icon" href="favicon" type="image/x-icon">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: #535353;
            justify-content: center;
            width: 100%;
            overflow: hidden;
        }
        @media only screen and (max-width: 1000px) {
            body {
                overflow: auto;
            }
        }
        body.blur::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            backdrop-filter: blur(3px);
            transition: backdrop-filter 2s ease;
            z-index: 1;
        }
        .TopLay {
            background-color: #303030;
            width: 100%;
            height: 10vh;
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        .TopMid1 {
            width: 15%;
            height: 10vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: solid black;
        }
        .TopMid2 {
            width: 70%;
            height: 10vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .TopMid3 {
            width: 15%;
            height: 10vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-left: solid black;
        }
        .TopMid3 h2 {
            color: white;
            font-size: 1.5vw;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .Mid {
            display: flex;
            flex-direction: row;
        }
/*____________________________________________________________________________________________________________*/
        .LeftLay {
            background-color: #303030;
            width: 15%;
            height: 90vh;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            overflow-x: hidden;
            border-top: solid black;
        }
        .LeftLay ul {
            list-style: none;
            margin: 0;
            padding: 0;
            align-self: center;
            justify-content: center;
            width: 90%;
        }
        .list-item {
            list-style: none;
            cursor: pointer;
            color: white;
            padding: 1.4vh;
            border-radius: 6vw;
            text-align: center;
            background-color: #4b4b4b;
            font-size: 1.2vw;
            margin-bottom: 2vh;
            border: 0.15vw solid #1A1A1A;
            font-weight: bold;
        }
        .list-item.active {
            background-color: #1E90FF;
        }
        .list-item2 {
            box-sizing: border-box;
            border-top: 0.3vw solid black;
            border-bottom: 0.3vw solid #303030;
            border-left: 0.3vw solid #303030;
            border-right: 0.3vw solid #303030;
            padding: 0.8vh;
            cursor: pointer;
            color: white;
            text-align: center;
            background-color: #4b4b4b;
            background-clip: border-box;
            font-size: 1vw;
        }
        .list-item22 {
            box-sizing: border-box;
            border-top: 0.3vw solid black;
            border-bottom: 0.3vw solid black;
            border-left: 0.3vw solid #303030;
            border-right: 0.3vw solid #303030;
            padding: 0.8vh;
            color: white;
            text-align: center;
            background-color: #4b4b4b;
            background-clip: border-box;
            font-size: 1vw;
        }
        .list-item2:last-child {
            border-bottom: 0.3vw solid black;;
        }
        .list-item2.active {
            border-color: #1E90FF;
        }
        #floorContainer input {
          padding: 8px;
          margin: 5px 0;
          border: 1px solid #ccc;
          width: 100%;  /* or any desired width */
        }
        #unitContainer input {
          padding: 8px;
          margin: 5px 0;
          border: 1px solid #ccc;
          width: 100%;  /* or any desired width */
        }
/*____________________________________________________________________________________________________________*/
        .MidLay {
            background-color: #1f1f1f;
            width: 70%;
            height: 90vh;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            border: solid black;
            overflow-x: auto;
            overflow-y: hidden;
        }
        #partListContainer {
            background-color: #1f1f1f;
            border-radius: 20px;
            padding: 40px;
            width: 80vw; /* 95% of the viewport's width */
            height: 95%;
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
        }

        .part-item {
            width: 96%;
            padding: 10px;
            margin-bottom: 10px;
            border: 2px solid white;
            border-radius: 10px;
            color: #ffffff;
        }
        .part-item > div.contentWrapper {
            display: none;
        }

        .part-item h2 {
            font-size: 24px;
            margin-bottom: 10px;
            cursor: pointer; /* Making the title clickable */
        }

        .part-item ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .part-item li {
            margin-bottom: 5px;
        }

        .part-item button {
            height: 4vw;
            padding: 1vw 1.5vw;
            font-size: 1.2vw;
            background-color: #1E90FF;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Scrollbar styles */
        #partListContainer::-webkit-scrollbar {
            width: 8px;
        }

        #partListContainer::-webkit-scrollbar-track {
            background-color: transparent;
        }

        #partListContainer::-webkit-scrollbar-thumb {
            background-color: #585858;
            border-radius: 20px;
        }

        #partListContainer::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
        .unit-list::-webkit-scrollbar {
            width: 8px;
        }

        .unit-list::-webkit-scrollbar-track {
            background-color: transparent;
        }

        .unit-list::-webkit-scrollbar-thumb {
            background-color: #585858;
            border-radius: 20px;
        }

        .unit-list::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }
        .part-description { /* This will hide the description initially */
            display: none;
        }
        .unit-list {
            flex: 0 0 auto;
            width: 45vw;
            overflow-x: hidden;
            max-height: 85vw;
            overflow-y: auto;          
            border: 0.6vw solid #4b4b4b;
            padding: 10px;
            font-size: 2vw;
            color: white;
            margin-top: -2vw;
            box-shadow: rgba(0, 0, 0, 1.4) 0 8px 15px;
            margin-left: 10px;
        }
        .unit-list h2 {
            font-size: 2.2vw;
        }
/*____________________________________________________________________________________________________________*/
#MidLay3 {
            background-color: #1f1f1f;
            width: 70%;
            height: 90vh;
            display: none;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            border: solid black;
        }
        .modpart-item {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            margin-left: 2vw;
            border: 2px solid #585858;
            border-radius: 10px;
            color: #ffffff;
        }
        .modpart-item > div.contentWrapper {
            display: none;
        }
        .modpart-item h2 {
            font-size: 2vw;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .modpart-item ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .modpart-item li {
            margin-bottom: 5px;
            font-size: 1.8vw;
        }
        .modpart-item button {
            margin-top: 10px;
            padding: 5px 10px;
            font-size: 16px;
            background-color: #1E90FF;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }     
        .modunit-list {
            flex: 0 0 auto;
            min-width: 450px;
            max-height: auto;
            overflow-y: auto;
            overflow-x: hidden;
            margin-right: 10px;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .modmain-title {
            color: white; /* Change color to white */
            text-align: center; /* Center align the title */
            margin-bottom: 20px; /* Add some spacing below the title */
        }
        .modunit-list h3 {
            color: white; /* Change color to white for unit titles */
            margin-top: 0; /* Remove any default top margin */
        }
        .modpart-item img {
            max-width: 100%; /* Ensures the image doesn't overflow its container */
            border-radius: 10px; /* Optional rounded corners */
            margin-right: 2vw;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Optional shadow for a bit of depth */
        }
/*____________________________________________________________________________________________________________*/
        .RightLay {
            background-color: #303030;
            width: 15%;
            height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            overflow-x: hidden;
            border-top: solid black;
        }
        .RightLay ul {
            width: 200%;
            margin-left: -1.6vw;
        }
        #changeUrlBtn {
            padding: 10px 20px;
            background-color: #1E90FF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .Numb {
            width: 100%;
            list-style: none;
            box-sizing: border-box;
            padding: 0.8vh;
            color: white;
            text-align: center;
            background-color: #4b4b4b;
            background-clip: border-box;
            font-size: 1vw;
        }
        .Numb:first-child {
            border-top: 0.3vw solid black;;
        }
        .Numb:last-child {
            border-bottom: 0.3vw solid black;;
        }
        .stlHis {
            width: 100%;
            height: 2.3vw;
            list-style: none;
            box-sizing: border-box;
            color: white;
            border: 1px solid #000000;
            text-align: center;
            background-color: #4b4b4b;
            background-clip: border-box;
            font-size: 1vw;
            margin-bottom: 1vw;
            cursor: pointer;
        }
        .expandable1 {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.15s ease-in-out, border-color 0.1s ease;
            display: flex;
            border: solid rgba(75, 75, 75, 0) 5px; /* Initially transparent border */
        }

        .expandable1.visible {
            max-height: 500px;
            border-color: rgba(75, 75, 75, 1); /* Transition to opaque border */
        }
        .carousel {
            position: relative;
            width: 100%;
            overflow: hidden;
            margin-left: 1vw;
            border-left: solid #4b4b4b 5px;
            }

            .carousel-images {
            display: flex;
            width: 100%;
            transition: transform 0.5s ease;
            }

            .carousel-images img {
            width: 100%;
            height: 25vw;
            }

            .carousel-pagination {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            }

            .carousel-pagination-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #888;
            margin: 0 5px;
            cursor: pointer;
            }

            .carousel-pagination-dot.active {
            background-color: #bbb;
            }
            .bigScreenB {
            position: absolute;
            top: 0;
            right: 0;
            width: 3vw;
            height: 3vw;
            border-radius: 20%;
            cursor: pointer;
            }
            input[type=checkbox]{
                height: 0;
                width: 0;
                visibility: hidden;
            }

            .swB {
                cursor: pointer;
                text-indent: -9999px;
                width: 4.4vw;
                height: 2vw;
                background: #1E90FF; /* Default color */
                display: block;
                border-radius: 100px;
                position: relative;
            }

            .swB:after {
                content: '';
                position: absolute;
                top: 0;
                bottom: 0;
                right: 5px; /* Position on the right by default */
                width: 2vw;
                height: 2vw;
                background: #fff;
                border-radius: 90px;
                transition: 0.2s;
            }

            input:checked + .swB {
                background: #5c5c5c; /* Grey background when not checked */
            }

            input:checked + .swB:after {
                left: 5px; 
                transform: none;
            }

            .swB:active:after {
                width: 3vw;
            }
            .button-28 {
            background-color: #5c5c5c;
            border: 0.15vw solid #1A1A1A;
            border-radius: 1vw;
            box-sizing: border-box;
            color: white;
            cursor: pointer;
            display: inline-block;
            font-size: 1vw;
            font-weight: bold;
            padding: 1.4vh;
            width: 80%;
            outline: none;
            text-align: center;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
            }
            .button-28:disabled {
            pointer-events: none;
            }
            .button-28:active {
            background-color: #1E90FF;
            transform: translateY(-2px);
            } 
            .button-28.active {
            background-color: #1E90FF;
            transform: translateY(-2px);
            } 
            .button-29 {
            background-color: #5c5c5c;
            border: 0.1vw solid #ff0000;
            border-radius: 1vw;
            box-sizing: border-box;
            color: white;
            cursor: pointer;
            display: inline-block;
            font-size: 1vw;
            font-weight: bold;
            padding: 1.4vh;
            width: 80%;
            outline: none;
            text-align: center;
            transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
            } 
            .button-29:disabled {
            pointer-events: none;
            }
            .button-29:active {
            background-color: #ff0000;
            transform: translateY(-2px);
            } 
            .button-29.active {
            background-color: #ff0000;
            transform: translateY(-2px);
            }  
            .quiz {
            position: absolute;
            display: flex;
            flex-direction: column;
            background-color: #252525;
            top: 0;
            left: 0;
            width: 100%;
            height: 70%;
            border-radius: 15px;
            align-items: center;
            color: white;
            opacity: 0;
            transition: all 0.2s ease;
            }
            .Qwrapper0 {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #252525;
            width: 40%;
            height: 80vh;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            border: 0.4vw solid black;
            opacity: 0;
            transition: opacity 0.2s ease;
            }
            .shrinkB {
            width: 7vw;
            height: 4vh;
            border-radius: 1vw;
            border: none;
            background-color: rgb(35, 150, 0);
            color: white;
            transition: transform 0.1s ease;
            }

            .shrinkB:active {
            transform: scale(0.90);
            background-color: rgb(8, 102, 0);
            }
            .circular-checkbox {
            position: relative;
            cursor: pointer;
            width: 2vw;
            height: 2vw;
            border: solid 0.3vw gray;
            border-radius: 50%;
            }
            .circular-check {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            width: 1.2vw;
            height: 1.2vw;
            border-radius: 50%;
            transition: all 0.2s ease;
            background-color: #1E90FF;
            opacity: 0;
            }
            .circular-checkbox.toggle .circular-check {
            opacity: 1;
            }
            .partRowDel {
                font-size: 2vw;
                cursor: pointer;
                width: 10vw;
                height: 6vh;
                border-radius: 1vw;
                border: none;
                background-color: #1E90FF;
                color: white;
                transition: transform 0.1s ease;
                margin-top: 4vh;
                margin-left: calc(50% - 5vw);
            }
            .partRowDel:active {
                transform: scale(0.90);
                background-color: #0c69c5;
            }

    </style>
</head>
<body>
    <div class="TopLay">
        <div class="TopMid1">
            <img src="https://midtowndrywall.ca/cdn/shop/files/logo_d46d7a71-4fe4-40e3-b5bc-2485b00d5e1d.png?v=1686707368" style="width: 10vw;">
        </div>
        <div id="notifPanel" style=" width: 50%; height: 60%; background-color: #4e4e4e; border: 0.2vw solid black; border-radius: 3%; display: flex; flex-direction: column; align-items: center; scale: 0; transition: scale 0.05s ease; position: fixed; z-index: 100;">
            <h2 style="font-size: 2vw; font-weight: bold; display: none;" id="notiTitle">New order available</h2>
        </div>
        <div class="TopMid2">
            <img src="https://192.168.2.32/bell1" style="width: 4%; cursor: pointer; transform: translateX(-20vw);" onclick="notif(this);" id="notifBell">
            <h1 style="color: white; font-size: 3vw;">Receive Page</h1>
        </div>
        <div class="TopMid3">
            <h2 style="color: white;" id="curUser">User:&nbsp</h2>
            <h2 style="color: white;" id="HourHour"></h2>
            <button style="width: fit-content; height: 2vw; font-size: 1.5vw; background-color: #1E90FF; color: white; border: none; border-radius: 5px; cursor: pointer;" id="Discon">Disconnect</button>
        </div>
    </div>
    <div class="Mid">
        <div class="LeftLay">
            <h2 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.7vw;">Worksite:</h2>
            <ul id="listContainer"></ul>
            <h2 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.7vw;">Sorting:</h2>
            <button class="button-28" role="button" id="groupB" style="justify-content: center; align-self: center;">All Orders</button>
            <div id="filterCont" style="width: 92%; display: flex; flex-direction: column; align-items: center; align-self: center; border-radius: 2vw; margin-top: 1vw;">
            <button hx-get="/recQuiz" hx-swap="beforeend" class="button-28" role="button" id="fltB" style="justify-content: center; align-self: center; margin-top: 1vh; width: 90%;">Filter</button>
            <div id="filterExpend" style="display: flex; flex-direction: column; visibility: hidden; max-height: 0; transition: max-height 0.5s ease-in-out;">
            <h1 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.1vw; margin-top: 3vh;">Parts displayed by row:</h1>
            <input id="filterInputR" type="number" style="width: 40%; align-self: center; font-size: 1vw;" value="10" autocomplete="off">
            <h1 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.1vw; margin-top: 3vh;">Parts filter:</h1>
            <select id="filterSelectP" style="width: 60%; font-size: 1vw; align-self: center;" autocomplete="off">
                <option value="">All part</option>
                <option value="part1">90° Profile</option>
                <option value="part2">30° Knife Edge</option>
                <option value="part3">45° Knife Edge</option>
                <option value="part4">90° 3 Way Profile</option>
                <option value="part5">135° Bulkhead Profile</option>
                <option value="part6">135° Profile</option>
                <option value="part7">C-Cap Profile</option>
                <option value="part8">Column Profile</option>
                <option value="part9">Fire Rated Enclosure Double</option>
                <option value="part10">Fire Rated Enclosure</option>
                <option value="part11">Hat Profile</option>
                <option value="part12">Multi-Step profile</option>
                <option value="part13">Radius Bulkhead</option>
                <option value="part14">Radius Profile</option>
                <option value="part15">90° 4 Way Profile</option>
            </select>
            <div style="align-self: center; margin-top: 2vh;">
                <input type="checkbox" id="shB" />
                <label for="shB" class="swB" style="margin-left: 1vw;"></label>
                <h1 style="font-size: 1vw; font-weight: bold; color: white; margin-top: 0.4vw;">Group By Sheet</h1>
            </div>
            </div>
            </div>
            <button class="button-29" role="button" id="rmvAllCheck" style="justify-content: center; align-self: center; margin-top: 1vw; margin-bottom: 2vh;" onclick="rmvAllCheck();">Remove all checked parts</button>
        </div>
        <div class="MidLay" id="MidLay1" style="display: none;">
            <div id="partListContainer">
                <ul id="partList"></ul>
            </div>
        </div>
        <div class="MidLay" id="MidLay2" style="display: flex;"></div>
        <div id="MidLay3">
        </div>
        <div class="RightLay">
          <h2 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.7vw;">Part Ordered:</h2>
          <ul id="Nsheet">
            <li class="Numb" id="Norder">- Quantity:</li>
          </ul>
          <h2 style="display: flex; justify-content: center; width: 100%; align-self: center; color: white; box-sizing: border-box; font-size: 1.7vw;">History:</h2>
          <ul id="listHis"></ul>
          <button id="changeUrlBtn">View Full History</button>
          <br>
          <br>
        </div>
        </div>
    </div>
    <script>
        var backendURL = "https://192.168.2.32:443";
        var Cinfo = {
            "time": "",
            "user": "",
            "worksite": "",
            "floor": "",
            "unit": "",
            "type": "",
            "part": "",
            "side": "",
            "thickness": "",
            "width": "",
            "length": "",
            "dA": "",
            "dB": "",
            "dC": "",
            "dD": "",
            "dE": "",
            "d1A": "",
            "d2A": "",
            "d1B": "",
            "d2B": "",
            "dR": "",
            "dR_P": "",
            "dH": "",
            "dW": "",
            "edgeA": "",
            "edgeB": "",
            "price": "",
            "check": "",
            "rand": ""
        }
        const partListContainer = document.getElementById("partListContainer");
        const partListContainer2 = document.getElementById("partListContainer2");
        const partTitles = {
        part1: "90° Profile",
        part2: "30° Knife Edge",
        part3: "45° Knife Edge",
        part4: "90° 3 Way Profile",
        part5: "135° Bulkhead Profile",
        part6: "135° Profile",
        part7: "C-Cap Profile",
        part8: "Column Profile",
        part9: "Fire Rated Enclosure Double",
        part10: "Fire Rated Enclosure",
        part11: "Hat Profile",
        part12: "Multi-Step profile",
        part13: "Radius Bulkhead",
        part14: "Radius Profile",
        part15: "90° 4 Way Profile",
        };
        const partData = {
            part1: {
                title: "90° Profile",
                imageUrl: backendURL + "/image1"
            },
            part2: {
                title: "30° Knife Edge",
                imageUrl: backendURL + "/image2"
            },
            part3: {
                title: "45° Knife Edge",
                imageUrl: backendURL + "/image3"
            },
            part4: {
                title: "90° 3 Way Profile",
                imageUrl: backendURL + "/image4"
            },
            part5: {
                title: "135° Bulkhead Profile",
                imageUrl: backendURL + "/image5"
            },
            part6: {
                title: "135° Profile",
                imageUrl: backendURL + "/image6"
            },
            part7: {
                title: "C-Cap Profile",
                imageUrl: backendURL + "/image7"
            },
            part8: {
                title: "Column Profile",
                imageUrl: backendURL + "/image8"
            },
            part9: {
                title: "Fire Rated Enclosure Double",
                imageUrl: backendURL + "/image9"
            },
            part10: {
                title: "Fire Rated Enclosure",
                imageUrl: backendURL + "/image10"
            },
            part11: {
                title: "Hat Profile",
                imageUrl: backendURL + "/image11"
            },
            part12: {
                title: "Multi-Step profile",
                imageUrl: backendURL + "/image12"
            },
            part13: {
                title: "Radius Bulkhead",
                imageUrl: backendURL + "/image13"
            },
            part14: {
                title: "Radius Profile",
                imageUrl: backendURL + "/image14"
            },
            part15: {
                title: "90° 4 Way Profile",
                imageUrl: backendURL + "/image15"
            }
        };
        var AllCD = false
        let dict = [];
        let dict2 = {};
        var nbr = "10";
        let savedData = [];
        var ftchDta = [];
        var workCh = false;
        var floorCh = false;
        let groupSort = true;
        let unitSort = false;
        var partSort = "";
        var firstL = 1;
        var alternate = false;
        var oldSheet = '';
        var edP = "/sortSize2";
        var Exlen = "";
        var LocalHis = document.getElementById("listHis");
        const imgdiv1 = document.createElement('div');
        const imgdiv2 = document.createElement('div');
        const imgdivimg = document.createElement('img');
        const img2divimg = document.createElement('img');
        const ulll = document.getElementById('Nsheet');
        var svdta = [];
        var svdta2 = [];
        var prstGet = [];
        var nsheet = [];
        var sheetMap = {};
        let ooldd1;
        let ooldd2;
        var autoFetch = true;
        var savedDataNotif = [];
//____________________________________________________________________________________________________________________________________________________
//Top right info logic


        function notif(that) {
            const bell = that.getBoundingClientRect();
            const panel = document.getElementById('notifPanel');
            if (panel.style.scale === '0') {
                panel.style.left = bell.left + 'px';
                panel.style.top = bell.bottom + 'px';
                panel.style.scale = 1;
            } else {
                panel.style.scale = 0;
            }
            if (document.getElementById('notifBell').src === backendURL.replace(':443', '') + '/bell2') {
                document.getElementById('notifBell').src = backendURL + '/bell1';
            }
        }
        function notifPanel(noti) {
            const bell = document.getElementById('notifBell');
            const panel = document.getElementById('notifPanel');
            bell.src = backendURL + '/bell2';
            document.getElementById('notiTitle').style.display = 'block';
            const tt2 = document.createElement('p');
            tt2.style.margin = 0;
            const tt3 = document.createElement('p');
            tt3.style.margin = 0;
            tt3.style.marginTop = '0.5vw';
            const bb = document.createElement('div');
            if (noti[0].priority === 'Standard Processing') {
                bb.style.border = '0.2vw solid green';
            } else if (noti[0].priority === 'Flexible Timing') {
                bb.style.border = '0.2vw solid yellow';
            } else if (noti[0].priority === 'Priority Fulfillment') {
                bb.style.border = '0.2vw solid red';
            }
            bb.style.borderRadius = '1vw';
            bb.style.cursor = 'pointer';
            bb.style.padding = '1vw';
            bb.style.backgroundColor = '#303030';
            bb.style.color = 'white';
            bb.style.fontSize = '1.3vw';
            bb.style.display = 'flex';
            bb.style.flexDirection = 'column';
            bb.style.boxShadow = 'rgba(0, 0, 0, 0.8) 0 8px 15px';
            bb.style.alignItems = 'center';
            bb.style.marginBottom = '2vw';
            tt2.innerText = noti[0].groupO.split("/ ")[1];
            tt3.innerText = 'Priority: ' + noti[0].priority;
            bb.appendChild(tt2);
            bb.appendChild(tt3);
            bb.addEventListener('click', function() {
                autoFetch = false;
                groupSort = true;
                partListContainer.innerHTML = "";
                svdta2 = [];
                nbr = "";
                partSort = "";
                firstL = 1;
                while (ulll.children.length > 1) {
                    ulll.removeChild(ulll.children[1]);
                }
                nsheet = [];
                displayPartList(noti);
                panel.style.scale = 0;
            });
            panel.appendChild(bb);

        }

        const getUser = async () => {
            try {
                const response = await fetch(backendURL + '/getCurUser');
                const data = await response.json();
                Cinfo.user = data.user
                document.getElementById('curUser').textContent = ('User: ' + Cinfo.user);
            } catch (error) {
                console.error('Error getting user info:', error);
            }
        };

        function UpdateTime() {
            const currentDate = new Date();
            const currentHour = currentDate.getHours();
            const currentMinute = currentDate.getMinutes();
            const currentSecond = currentDate.getSeconds();
            const currentDay = currentDate.getDate();
            const currentMonth = currentDate.getMonth();
            const currentYear = currentDate.getFullYear();
            const formattedDate = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${currentDay.toString().padStart(2, '0')}`;
            const formattedTime = `${currentHour}:${currentMinute.toString().padStart(2, '0')}`;
            const combinedText = `${formattedTime} / ${formattedDate}`;
            document.getElementById('HourHour').textContent = combinedText;
            tmpT = (60 - currentSecond) * 1000;
            return currentMinute
        }

        document.getElementById('Discon').addEventListener('click', function() {
            fetch(backendURL + "/rmCook", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user: Cinfo.user })
            });
            window.location.href = backendURL;
        });

        getUser();
        UpdateTime();
        setInterval(UpdateTime, tmpT);

//____________________________________________________________________________________________________________________________________________________
//Location logic

        const listContainer = document.getElementById('listContainer');

        const toggleActive = (element) => {
            // Clear 'active' class from siblings
            const siblings = element.parentNode.children;
            for (let i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('active');
            }
            // Set 'active' class for clicked element
            element.classList.add('active');
            if (element.classList.contains('active')) {
                workCh = true;
            } else {
                workCh = false;
            }
        };

        const toggleActive2 = (element) => {
            // Clear 'active' class from siblings
            const siblings = element.parentNode.children;
            if (element.classList.contains('active')) {
                floorCh = false;
                for (let i = 0; i < siblings.length; i++) {
                    siblings[i].classList.remove('active');
                }
                return
            }
            for (let i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('active');
            }
            // Set 'active' class for clicked element
            element.classList.add('active');
            if (element.classList.contains('active')) {
                floorCh = true;
            } else {
                floorCh = false;
            }
        };

        const fetchData = async () => {
            try {
                const response = await fetch(backendURL + '/getWorksites');
                const data = await response.json();

                data.worksites.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-item';
                    listItem.textContent = item.worksite;
                    listItem.addEventListener('click', () => {
                        toggleActive(listItem);
                        floorCh = false;
                        if (document.getElementById('MidLay3').style.display === 'flex') {
                            fetch(backendURL + "/viewHis2")
                            .then((response) => response.json())
                            .then((data) => displayModPartList(data))
                            .catch((error) => console.error(error));
                        }
                        Cinfo.worksite = item.worksite;
                        Cinfo.floor = "";
                        document.getElementById('groupB').click()
                        autoFetch = true;
                        getPrst();
                        fetchAndDisplayData();
                        fetch(backendURL + "/selectWorksite", {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(Cinfo)
                        })
                    });
                    listContainer.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching worksites:', error);
            }
        };

        const fetchData2 = async () => {
            try {
                const listContainer2 = document.createElement('ul');
                const response = await fetch(backendURL + '/getFloors2');
                const data = await response.json();
                listContainer2.innerHTML = "";
                data.floors.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-item';
                    listItem.textContent = item.floor;
                    listItem.addEventListener('click', () => {
                        toggleActive2(listItem);
                        if (document.getElementById('MidLay3').style.display === 'flex') {
                            fetch(backendURL + "/viewHis2")
                            .then((response) => response.json())
                            .then((data) => displayModPartList(data))
                            .catch((error) => console.error(error));
                        }
                        Cinfo.floor = item.floor;
                    });
                    listContainer2.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching worksites:', error);
            }
        };

        // Initialize by fetching worksites when the page loads.
        fetchData();
        document.getElementById('groupB').addEventListener('click', function() {
            if (workCh) {
                document.getElementById('fltB').classList.remove('active');
                this.classList.add('active');
                groupSort = true;
                partListContainer.innerHTML = "";
                savedData = [];
                svdta2 = [];
                nbr = "";
                partSort = "";
                firstL = 1;
                autoFetch = true;
                fetchAndDisplayData();
                document.getElementById('filterCont').style.border = 'none';
                document.getElementById('filterExpend').style.maxHeight = 0;
                document.getElementById('filterExpend').style.visibility = 'hidden';
            } else {
                alert("Please choose a worksite");
            }
        });
        function toggleCheckbox(thiss, x, y) {
            if (x) {
                document.querySelectorAll('.circular-checkbox').forEach(function(element) {
                    element.classList.remove('toggle');
                });
            } else {
                if (!svdta.includes(y)) {
                    svdta.push(y);
                } else {
                    svdta = svdta.filter(item => item !== y);
                }
            }
            thiss.classList.toggle('toggle');
        }

        document.getElementById('shB').addEventListener('click', function() {
            this.classList.toggle('active');
            if (this.classList.contains('active')) {
                edP = "/sortSize1";
            } else {
                edP = "/sortSize2";
            }
            getPart();
        });

        async function fetchNewData() {
            try {
                const response = await fetch(backendURL + "/getOrders");
                const data = await response.json();
                console.log(data);
                ftchDta = data.filter(item => item.worksite === Cinfo.worksite);
                console.log(ftchDta);
            } catch (error) {
                console.error(error);
            }
        }
        async function getPrst() {
            fetch(backendURL + "/getPrst", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user: Cinfo.user, work: Cinfo.worksite })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                return response.json();
            })
            .then(data => {
                prstGet = data;
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
        function savePrst(txt) {
            fetch(backendURL + "/savePrst", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user: Cinfo.user, work: Cinfo.worksite, sort: partSort, constr: svdta, nbr: nbr, name: txt })
            })
            .then(response => {
                getPrst();
            });
        }

        function getPart() {
            svdta = svdta2;
            groupSort = false;
            unitSort = false;
            fetch(backendURL + edP, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ nbr: nbr, work: Cinfo.worksite, sort: partSort, constr: svdta })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                        document.getElementById('MidLay1').style.display = 'none';
                        document.getElementById('MidLay2').style.display = 'flex';
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById('MidLay1').style.display = 'flex';
                    document.getElementById('MidLay2').style.display = 'none';
                    autoFetch = false;
                    savedData = data.PartsWithSheets;
                    while (ulll.children.length > 1) {
                        ulll.removeChild(ulll.children[1]);
                    }
                    nsheet = [];
                    if (data.Summaries) {
                        nsheet = data.Summaries;
                    }
                    if (data.PartsWithSheets) {
                        displayPartList(data.PartsWithSheets);
                        setTimeout(() => {
                            let c1, c2, c3;
                            let noonne = {};
                            document.querySelectorAll('.part-item').forEach(element => {
                                const prt = JSON.parse(element.getAttribute('data-part-data'));
                                if (sheetMap[prt.sheet] === undefined) {
                                    sheetMap[prt.sheet] = 0;
                                    sheetMap[prt.sheet + '_2'] = 0;
                                }
                                if (prt.check !== "1") {
                                    sheetMap[prt.sheet] += 1;
                                }
                                sheetMap[prt.sheet + '_2'] += 1;
                            });
                            document.querySelectorAll('.part-item').forEach(element => {
                                const prt = JSON.parse(element.getAttribute('data-part-data'));
                                if (prt.check === "1" && prt.sheet === "") {
                                    Array.from(document.getElementById("Nsheet").children).forEach(item => {
                                        if (item.innerText.split(':')[0].split(' ')[0] === "Type" || item.innerText.split(':')[0].split(' ')[0] === "Mold") {
                                            c1 = item.innerText.split(':')[0].split(' ')[0] + ' ' + item.innerText.split(':')[0].split(' ')[1];
                                            c2 = item.innerText.split(':')[0].split(' ')[2];
                                            c3 = (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/)[0] : "";
                                        } else {
                                            c1 = item.innerText.split(':')[0].split(' ')[0];
                                            c2 = item.innerText.split(':')[0].split(' ')[1];
                                            c3 = (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/)[0] : "";
                                        }
                                        if (c1 === prt.type && c2 === prt.thickness && c3 === prt.length2) {
                                            item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + (item.innerText.split(':')[1].split(' ')[1] - 1);
                                        }
                                    });
                                } else if (prt.check === "1" && prt.sheet !== "") {
                                    Array.from(document.getElementById("Nsheet").children).forEach(item => {
                                        if (item.innerText.split(':')[0].split(' ')[0] === "Type" || item.innerText.split(':')[0].split(' ')[0] === "Mold") {
                                            c1 = item.innerText.split(':')[0].split(' ')[0] + ' ' + item.innerText.split(':')[0].split(' ')[1];
                                            c2 = item.innerText.split(':')[0].split(' ')[2];
                                            c3 = (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/)[0] : "";
                                        } else {
                                            c1 = item.innerText.split(':')[0].split(' ')[0];
                                            c2 = item.innerText.split(':')[0].split(' ')[1];
                                            c3 = (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/)[0] : "";
                                        }
                                        if (c1 === prt.type && c2 === prt.thickness && c3 === prt.length2) {
                                            if (sheetMap[prt.sheet] === 0 && noonne[prt.sheet] === undefined) {
                                                noonne[prt.sheet] = true;
                                                item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + (item.innerText.split(':')[1].split(' ')[1] - 1);
                                            }
                                        }
                                    });
                                }
                            });
                        }, "800");
                    } else {
                        displayPartList(data);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function rmPrst(txt) {
            fetch(backendURL + "/rmPrst", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({user: Cinfo.user, work: Cinfo.worksite, name: txt })
            })
            .then(response => {
                getPrst();
            });
        }

//____________________________________________________________________________________________________________________________________________________
// Parts logic
// Function to generate a unique ID for each part
function generatePartId(part) {
            return part.part; // Use part.part as the unique identifier
        }

        function isEmptyPart(part) {
            // Function to check if a part is empty (all dimensions are empty)
            return (
                part.dA === "" &&
                part.dB === "" &&
                part.dC === "" &&
                part.dD === "" &&
                part.dE === "" &&
                part.dH === "" &&
                part.dR === "" &&
                part.dR_P === "" &&
                part.dW === ""
            );
        }

        function addDetail(ul, label, value) {
            const excludedKeys = ["User", "Worksite", "Price", "Rand", "UniqueID", "UniqueID2", "Side", "Unit", "Order", "Floor", "Time", "Checktime", "Check", "Sheet", "Order2", "Length2", "Sum", "Img", "GroupO", "Priority", Exlen];
            if (label === 'Mrg') {
                const detailItem = document.createElement("li");
                detailItem.textContent = 'Time: 23:55 / 2055-55-55';
                detailItem.style.marginBottom = '4vw';
                detailItem.style.opacity = 0;
                ul.appendChild(detailItem);
                return;
            }
            if (value.trim() !== "" && value.trim() !== "black" && !excludedKeys.includes(label)) {
                const detailItem = document.createElement("li");
                detailItem.textContent = `${label}: ${value}`;
                ul.appendChild(detailItem);
            }
        }

        function toggleBlur(focusDivId) {
            const body = document.body;
            body.classList.toggle('blur');
            if (body.classList.contains('blur')) {
                focusDivId.style.zIndex = '2';
            } else {
                focusDivId.style.zIndex = '';
            }
        }

        function createPartItem(part) {
            const partItem = document.createElement("div");
            partItem.setAttribute('data-part-data', JSON.stringify(part));
            partItem.setAttribute('data-uniqueID2', part.uniqueID2);
            partItem.classList.add("part-item");

            const container = document.createElement("div");
            container.style.display = 'flex';
            const title = partTitles[part.part] || part.part;
            const title2 = part.unit;
            const h2 = document.createElement("h2");
            const h22 = document.createElement("h2");
            const h222 = document.createElement("h2");
            const h2222 = document.createElement("h2");
            const separ1 = document.createElement("h2");
            const separ2 = document.createElement("h2");
            const separ3 = document.createElement("h2");
            h2.textContent = title;
            h22.textContent = title2;
            h222.textContent = part.order;
            h2222.textContent = part.floor;
            separ1.textContent = '|';
            separ2.textContent = '|';
            separ3.textContent = '|';
            h2.setAttribute('data-part-name', title);
            h2.style.marginRight = '0.4vw';
            h2222.style.marginRight = '0.4vw';
            h22.style.marginRight = '0.4vw';
            h222.style.marginLeft = 'auto';
            separ1.style.marginRight = '0.4vw';
            separ2.style.marginRight = '0.4vw';
            separ3.style.marginRight = '0.4vw';
            separ1.style.color = '#1E90FF';
            separ2.style.color = '#1E90FF';
            separ3.style.color = '#1E90FF';
            container.appendChild(h2);
            container.appendChild(separ1);
            container.appendChild(h2222);
            container.appendChild(separ2);
            container.appendChild(h22);
            container.appendChild(separ3);
            container.appendChild(h222);
            partItem.appendChild(container);
            if (part.type === "Mold Tuff") {
                partItem.style.boxShadow = '0 0 0 0.4vw blue';
            } else if (part.type === "DensGlass") {
                partItem.style.boxShadow = '0 0 0 0.4vw green';
            } else if (part.type === "Type C") {
                partItem.style.boxShadow = '0 0 0 0.4vw yellow';
            } else if (part.type === "Type X") {
                partItem.style.boxShadow = '0 0 0 0.4vw red';
            }

            const contentWrapper = document.createElement('div');
            contentWrapper.className = 'expandable1';
            contentWrapper.style.marginBottom = '1vw';

            const ul = document.createElement("ul");
            ul.style.position = 'relative';
            ul.style.marginTop = '1vw';
            ul.style.marginLeft = '1vw';

            if (part.length === part.length2) {
                Exlen = "Length";
            } else {
                Exlen = "";
                part.length = part.length + " inches"
            }
            for (const key in part) {
                if (key !== "part" && key !== "delch") {
                    addDetail(ul, key.charAt(0).toUpperCase() + key.slice(1), part[key]);
                }
            }
            addDetail(ul, 'Mrg', true);
            const detailItem = document.createElement("li");
            detailItem.textContent = `Time: ${part.time}`;
            detailItem.style.position = 'absolute';
            detailItem.style.bottom = 0;
            ul.appendChild(detailItem);
            contentWrapper.appendChild(ul);

            const partInfo = partData[part.part];
            if (partInfo && partInfo.imageUrl) {
                const carousel = document.createElement('div');
                carousel.className = 'carousel';

                const carouselImages = document.createElement('div');
                carouselImages.className = 'carousel-images';
                const bigScreenB = document.createElement('img');
                bigScreenB.className = 'bigScreenB';
                bigScreenB.src = "https://192.168.2.32:443/fscreen";
                const img = document.createElement('img');
                img.src = partInfo.imageUrl;
                img.style.width = "100%";
                img.style.height = "25vw";
                carouselImages.appendChild(img);
                if (part.img === "") {
                    carouselImages.style.width = '100%';
                }
                var imageUrl = "";
                let img2;
                if (part.img !== "") {
                    img2 = document.createElement('img');
                    img2.style.width = "auto";
                    img2.style.maxHeight = "25vw";
                    
                    fetch(backendURL + "/upIMG", {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ image: part.img })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        return response.blob();
                    })
                    .then(blob => {
                        imageUrl = URL.createObjectURL(blob);
                        img2.src = imageUrl;
                    })
                    .catch(error => {
                        console.error('There has been a problem with your fetch operation:', error);
                    });
                    carouselImages.appendChild(img2);
                }
                carousel.appendChild(carouselImages);
                carousel.appendChild(bigScreenB);
                contentWrapper.appendChild(carousel);

                var swImg = 1;
                if (img2) {
                    const carouselPagination = document.createElement('div');
                    carouselPagination.className = 'carousel-pagination';

                    const dot1 = document.createElement('div');
                    dot1.className = 'carousel-pagination-dot active';
                    dot1.addEventListener('click', () => switchImage(0));
                    carouselPagination.appendChild(dot1);

                    const dot2 = document.createElement('div');
                    dot2.className = 'carousel-pagination-dot';
                    dot2.addEventListener('click', () => switchImage(1));
                    carouselPagination.appendChild(dot2);
                    carousel.appendChild(carouselPagination);
                    function switchImage(index) {
                        const width = carousel.offsetWidth;
                        carouselImages.style.transform = `translateX(${-width * index}px)`;
                        dot1.classList.toggle('active', index === 0);
                        dot2.classList.toggle('active', index === 1);
                        if (swImg === 1) {
                            swImg = 2;
                        } else {
                            swImg = 1;
                        }
                    }
                    let currentIndex = 0;
                    function toggleImage() {
                        currentIndex = currentIndex === 0 ? 1 : 0;
                        switchImage(currentIndex);
                    }
                    img.addEventListener('click', toggleImage);
                    if (img2) {
                        img2.addEventListener('click', toggleImage);
                    }
                }
               const midDiv = document.getElementsByClassName('Mid');
                bigScreenB.addEventListener('click', function() {
                    imgdiv1.style.position = 'fixed';
                    imgdiv1.style.top = '50%';
                    imgdiv1.style.left = '50%';
                    imgdiv1.style.transform = 'translate(-50%, -50%)';
                    imgdiv1.style.width = '50vw';
                    imgdiv1.style.maxHeight = '90vh';
                    imgdiv1.style.border = 'solid 1vw black';
                    imgdiv1.style.borderRadius = '1vw';
                    imgdiv1.style.transition = 'opacity 0.2s ease-in-out';
                    imgdiv1.style.opacity = '0';
                    imgdivimg.src = partInfo.imageUrl;
                    imgdivimg.style.width = '50vw';
                    imgdivimg.style.maxHeight = '90vh';
                    imgdiv1.appendChild(imgdivimg);
                    imgdiv1.appendChild(bigScreenB);
                    imgdiv2.style.position = 'fixed';
                    imgdiv2.style.top = '50%';
                    imgdiv2.style.left = '50%';
                    imgdiv2.style.transform = 'translate(-50%, -50%)';
                    imgdiv2.style.width = '50vw';
                    imgdiv2.style.maxHeight = '90vh';
                    imgdiv2.style.border = 'solid 1vw black';
                    imgdiv2.style.borderRadius = '1vw';
                    imgdiv2.style.transition = 'opacity 0.2s ease-in-out';
                    imgdiv2.style.opacity = '0';
                    img2divimg.src = imageUrl;
                    img2divimg.style.width = '50vw';
                    img2divimg.style.maxHeight = '90vh';
                    imgdiv2.appendChild(img2divimg);
                    imgdiv2.appendChild(bigScreenB);
                    if (swImg === 1) {
                        if (!midDiv[0].contains(imgdiv1)) {
                            imgdiv1.appendChild(bigScreenB);
                            midDiv[0].appendChild(imgdiv1);
                            setTimeout(function() {
                                imgdiv1.style.opacity = '1';
                            }, 0);
                            toggleBlur(imgdiv1);
                        } else {
                            imgdiv1.style.opacity = '0';
                            carousel.appendChild(bigScreenB);
                            setTimeout(function() {
                                midDiv[0].removeChild(imgdiv1);
                                toggleBlur(imgdiv1);
                            }, 200);
                        }
                    } else {
                        if (!midDiv[0].contains(imgdiv2)) {
                            imgdiv2.appendChild(bigScreenB);
                            midDiv[0].appendChild(imgdiv2);
                            setTimeout(function() {
                                imgdiv2.style.opacity = '1';
                            }, 0);
                            toggleBlur(imgdiv2);
                        } else {
                            imgdiv2.style.opacity = '0';
                            carousel.appendChild(bigScreenB);
                            setTimeout(function() {
                                midDiv[0].removeChild(imgdiv2);
                                toggleBlur(imgdiv2);
                            }, 200);
                        }
                    }
                });
            }

            partItem.appendChild(contentWrapper);
            if (part.sheet !== "" && oldSheet != part.sheet) {
                if (alternate) {
                    alternate = false;
                } else {
                    alternate = true;
                }
            }
            if (part.sheet !== ""  && !alternate) {
                partItem.style.backgroundColor = 'rgb(95, 59, 27)';
            } else if (part.sheet !== ""  && alternate) {
                partItem.style.backgroundColor = 'rgb(39, 18, 0)';
            }
            oldSheet = part.sheet;
            container.addEventListener("click", function() {
            if (contentWrapper.classList.contains('visible')) {
                contentWrapper.classList.remove('visible');
                contentWrapper.style.maxHeight = '0';
            } else {
                contentWrapper.classList.add('visible');
                contentWrapper.style.maxHeight = '80vh'; // This should be greater than the actual height of the content
            }
            });
            const checkButton = document.createElement('button');
            checkButton.textContent = "✓";
            checkButton.addEventListener('click', function() {
                const isCurrentlyChecked = this.style.backgroundColor === 'green';
                this.style.backgroundColor = isCurrentlyChecked ? '' : 'green';
                if (this.style.backgroundColor === 'green') {
                    const parentPartItem = this.closest('.part-item');
                    if (parentPartItem) {
                        parentPartItem.style.border = '2px solid green';
                    }
                    if (nsheet.length !== 0) {
                        let jsonDataString = JSON.parse(parentPartItem.getAttribute('data-part-data'));
                        let c1, c2, c3;
                        Array.from(document.getElementById("Nsheet").children).forEach(item => {
                            if (item.innerText.split(':')[0].split(' ')[0] === "Type" || item.innerText.split(':')[0].split(' ')[0] === "Mold") {
                                c1 = item.innerText.split(':')[0].split(' ')[0] + ' ' + item.innerText.split(':')[0].split(' ')[1];
                                c2 = item.innerText.split(':')[0].split(' ')[2];
                                c3 = (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/)[0] : "";
                            } else {
                                c1 = item.innerText.split(':')[0].split(' ')[0];
                                c2 = item.innerText.split(':')[0].split(' ')[1];
                                c3 = (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/)[0] : "";
                            }
                            if (jsonDataString.sheet === "" && c1 === jsonDataString.type && c2 === jsonDataString.thickness && c3 === jsonDataString.length2) {
                                item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + (item.innerText.split(':')[1].split(' ')[1] - 1);
                            } else if (jsonDataString.sheet !== "" && c1 === jsonDataString.type && c2 === jsonDataString.thickness && c3 === jsonDataString.length2) {
                                sheetMap[jsonDataString.sheet] -= 1;
                                if (sheetMap[jsonDataString.sheet] === 0 && ooldd1 !== jsonDataString.uniqueID2) {
                                    item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + (item.innerText.split(':')[1].split(' ')[1] - 1);
                                }
                                ooldd1 = jsonDataString.uniqueID2;
                            }
                        });
                    }
                } else {
                    const parentPartItem = this.closest('.part-item');
                    if (parentPartItem) {
                        parentPartItem.style.border = '2px solid white';
                    }
                    if (nsheet.length !== 0) {
                        let jsonDataString = JSON.parse(parentPartItem.getAttribute('data-part-data'));
                        let c1, c2, c3;
                        let tnbr;
                        Array.from(document.getElementById("Nsheet").children).forEach(item => {
                            if (item.innerText.split(':')[0].split(' ')[0] === "Type" || item.innerText.split(':')[0].split(' ')[0] === "Mold") {
                                c1 = item.innerText.split(':')[0].split(' ')[0] + ' ' + item.innerText.split(':')[0].split(' ')[1];
                                c2 = item.innerText.split(':')[0].split(' ')[2];
                                c3 = (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[3] || "").match(/\d+/)[0] : "";
                            } else {
                                c1 = item.innerText.split(':')[0].split(' ')[0];
                                c2 = item.innerText.split(':')[0].split(' ')[1];
                                c3 = (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/) ? (item.innerText.split(':')[0].split(' ')[2] || "").match(/\d+/)[0] : "";
                            }
                            if (jsonDataString.sheet === "" && c1 === jsonDataString.type && c2 === jsonDataString.thickness && c3 === jsonDataString.length2) {
                                item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + (parseInt(item.innerText.split(':')[1].split(' ')[1]) + 1);
                            } else if (jsonDataString.sheet !== "" && c1 === jsonDataString.type && c2 === jsonDataString.thickness && c3 === jsonDataString.length2) {
                                sheetMap[jsonDataString.sheet] += 1;
                                if (sheetMap[jsonDataString.sheet] === sheetMap[jsonDataString.sheet + '_2']) {
                                    tnbr = (parseInt(item.innerText.split(':')[1].split(' ')[1]) + 1);
                                    nsheet.forEach(sheet => {
                                        if (c1 === sheet.type && c2 === sheet.thickness && c3 === sheet.length && parseInt(item.innerText.split(':')[1].split(' ')[1]) === sheet.count) {
                                            tnbr = sheet.count;
                                        }
                                    });
                                    if (ooldd1 !== jsonDataString.uniqueID2) {
                                        item.innerText = c1 + ' ' + c2 + ' ' + c3 + 'ft: ' + tnbr;
                                    }
                                }
                                ooldd1 = jsonDataString.uniqueID2;
                            }
                        });
                    }
                }
                const worksite = part.worksite;
                const floor = part.floor;
                const unit = part.unit;
                const partName = part.part;
                const side = part.side;
                const thickness = part.thickness;
                const length = part.length;
                const dA = part.dA;
                const dB = part.dB;
                const dC = part.dC;
                const dD = part.dD;
                const dE = part.dE;
                const d1A = part.d1A;
                const d2A = part.d2A;
                const d1B = part.d1B;
                const d2B = part.d2B;
                const dR = part.dR;
                const dR_P = part.dR_P;
                const dH = part.dH;
                const dW = part.dW;
                const edgeA = part.edgeA;
                const edgeB = part.edgeB;
                const unitList = document.querySelector(`.unit-list[data-unit="${unit}"]`);
                var check = ""
                var Uid2 = part.uniqueID2
                if (this.style.backgroundColor === 'green') {
                    check = "1"
                }
                if (this.style.backgroundColor === 'green') {
                    delCheck(part, partItem);
                } else {
                    delCheck2(part, partItem);
                }
                if  (!AllCD) {
                    calculateAndSendUnitProgress(Uid2, check);
                }
                AllCD = false
            });
            const container2 = document.createElement("div");
            container2.style.display = 'flex';
            const len22 = document.createElement("h2");
            if (part.length2) {
                len22.textContent = "Length: " + part.length2 + " ";
            } else {
                len22.textContent = "Length: " + part.length;
            }
            len22.style.marginLeft = "2vw";
            len22.style.marginTop = "0.7vw";
            container2.appendChild(checkButton);
            container2.appendChild(len22);
            partItem.appendChild(container2);
            if (part.check === "1") {
                checkButton.style.backgroundColor = 'green';
                const parentPartItem = checkButton.closest('.part-item');
                setTimeout(() => {
                    delCheck(part, partItem);
                }, 600);
                if (parentPartItem) {
                    parentPartItem.style.border = '2px solid green';
                }
            }
            return partItem;
        }

        function calculateAndSendUnitProgress(Uid2, check) {
            fetch(backendURL + "/unitProgress1", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                uid2: Uid2,
                check: check
            })
            })
            .then(response => response.json())
            .then(data => {
            })
            .catch(error => {
            });
        }

        function rmvAllCheck() {
            var sendDelPart = [];
            var DelPart = [];
            var delCol = [];
            document.querySelectorAll('.part-item').forEach(element => {
                if (element.style.border === '2px solid green') {
                    const prt = JSON.parse(element.getAttribute('data-part-data'));
                    sendDelPart.push(prt.uniqueID2);
                    DelPart.push(element);
                    if (element.parentNode.lastElementChild.tagName === 'BUTTON' && !delCol.includes(element.parentNode)) {
                        delCol.push(element.parentNode);
                    }
                }
            });
            const jsonArray = sendDelPart.map(value => ({ uniqueID2: value }));
            if (sendDelPart.length > 0) {
                fetch(backendURL + "/delReceive", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonArray)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    if (text && text.trim() !== "") {
                        return JSON.parse(text);
                    } else {
                        return { success: true };
                    }
                })
                .then(data => {
                    if(data.success) {
                        DelPart.forEach(i => {
                            i.remove();
                        });
                        delCol.forEach(i => {
                            i.remove();
                        });
                        callrHis();
                    } else {
                        console.error("Error deleting parts:", data.errorMessage);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            }
        }

        function delCheck(part, y) {
            for (let i = 0; i < dict.length; i++) {
                let item = dict[i];
                let key = Object.keys(item)[0];
                if (part.uniqueID === key) {
                    item[key] -= 1;                  
                    if (item[key] === 0) {
                        const btn = document.createElement('button');
                        btn.className = 'partRowDel'
                        btn.innerText = 'Delete';
                        y.parentNode.appendChild(btn);
                        btn.addEventListener('click', function() {
                            checkForAllChecked(part);
                        });
                    }
                }
            }
        }

        function delCheck2(part, y) {
            const btns = y.parentNode.getElementsByClassName('partRowDel');
            if (btns.length > 0) {
                btns[0].remove();
            }
            for (let i = 0; i < dict.length; i++) {
                let item = dict[i];
                let key = Object.keys(item)[0];
                if (part.uniqueID === key) {
                    item[key] += 1;
                }
            }
        }

        function checkForAllChecked(part) {
            const unitList = document.querySelector(`.unit-list[data-UniqueID2="${part.uniqueID}"]`);
            AllCD = true
            const matchingUniqueID2 = [];
            for (const item of savedData) {
                if (item.uniqueID === part.uniqueID) {
                    matchingUniqueID2.push(item.uniqueID2);
                }
            }
            savedData = savedData.filter(item => item.uniqueID !== part.uniqueID);
            const jsonArray = matchingUniqueID2.map(value => ({ uniqueID2: value }));
            // Now send this data with the POST request:
            fetch(backendURL + "/delReceive", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonArray)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
                return response.text();
            })
            .then(text => {
                // Check if there's content in the response
                if (text && text.trim() !== "") {
                    return JSON.parse(text);
                } else {
                    // If there's no content, return a default object indicating success
                    return { success: true };
                }
            })
            .then(data => {
                if(data.success) {
                    if (unitList) {
                        unitList.remove();
                    }
                    callrHis();
                } else {
                    // Handle any errors or unsuccessful deletions here
                    console.error("Error deleting parts:", data.errorMessage);
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });
            }
    function extractUserInfo(data) {
    if (data.length > 0) {
        userValue = data[0].user || "";   // Set default value if 'user' is not present
        worksiteValue = data[0].worksite || "";   // Set default value if 'worksite' is not present
        floorValue = data[0].floor || "";   // Set default value if 'floor' is not present
        unitValue = data[0].unit || "";   // Set default value if 'unit' is not present
    }
}

function createNewUnitList(part, uniqueID) {
    const unitList = document.createElement('div');
    unitList.className = 'unit-list';
    unitList.setAttribute('data-unit', part.unit);
    unitList.setAttribute('data-UniqueID2', uniqueID);

    // Insert the new unitList at the top of the partListContainer
    partListContainer.insertBefore(unitList, partListContainer.firstChild);
    return unitList;
}
function createNewUnitList2(part, uniqueID) {
    const unitList = document.createElement('div');
    unitList.className = 'unit-list';
    unitList.setAttribute('data-unit', part.unit);
    unitList.setAttribute('data-UniqueID2', uniqueID);

    // Insert the new unitList at the bottom of the partListContainer
    partListContainer.appendChild(unitList);
    return unitList;
}
function generateUniqueID() {
    return Math.random().toString(36).substr(2, 9);
}
function fractionToDecimal(frac = "") {
    // Ensure frac is a string and not an empty string.
    if (typeof frac !== "string" || !frac.trim()) {
        return 0;
    }

    if (frac.includes('.')) {
        let [whole, fraction] = frac.split('.');
        return parseFloat(whole) + fractionToDecimal(fraction);
    }
    
    const [num, denom] = frac.split('/').map(Number);
    return denom ? num / denom : num;
}
function decimalToFraction(decimal) {
    const tolerance = 0.0001;
    let wholeNumberPart = Math.floor(decimal);
    let fractionalPart = decimal - wholeNumberPart;
    let numerator = fractionalPart;
    let denominator = 1;

    while (Math.abs(fractionalPart * denominator - Math.round(fractionalPart * denominator)) > tolerance) {
        denominator++;
        numerator = Math.round(fractionalPart * denominator);
    }

    if (wholeNumberPart && numerator) {
        return `${wholeNumberPart}.${numerator}/${denominator}`;
    } else if (!wholeNumberPart && numerator) {
        return `${numerator}/${denominator}`;
    } else {
        return `${wholeNumberPart}`;
    }
}
// Helper function to add two fractions/decimals in string form and return as string
function addFractions(frac1, frac2) {
    const result = fractionToDecimal(frac1) + fractionToDecimal(frac2);
    return decimalToFraction(result);
}

function smallHis(parts) {
    parts.sort((a, b) => {
        const timeA = b.checktime.split(' / ')[0];
        const timeB = a.checktime.split(' / ')[0];
        const [hourA, minuteA] = timeA.split(':').map(Number);
        const [hourB, minuteB] = timeB.split(':').map(Number);
        if (hourA !== hourB) {
            return hourA - hourB;
        } else {
            return minuteA - minuteB;
        }
    });
    const partsArray = Array.isArray(parts) ? parts : [parts];
    partsArray.forEach(part => {
        if (part.checktime !== "") {
            const extractedDate = part.checktime.split(" / ")[1];
            const [year, month, day] = extractedDate.split("-").map(Number);
            const parsedDate = new Date(year, month - 1, day);
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth();  // 0-indexed
            const currentDay = currentDate.getDate();
            const today = new Date(currentYear, currentMonth, currentDay);
            if (part.user === Cinfo.user && parsedDate.getTime() === today.getTime()) {
                const ul = document.createElement("li");
                ul.classList.add("part-description");
                ul.style.marginTop = '0.5vw';
                for (const key in part) {
                    if (key !== "part" && key !== "delch") {
                        addDetail(ul, key.charAt(0).toUpperCase() + key.slice(1), part[key]);
                    }
                }
                const detailItem = document.createElement("li");
                detailItem.textContent = `Time: ${part.checktime}`;
                detailItem.style.marginTop = '1vw';
                ul.appendChild(detailItem);
                var titleElement = document.createElement("span");
                titleElement.innerText = partData[part.part].title;
                titleElement.style.lineHeight = '2.3vw';
                var lst = document.createElement("li");
                lst.className = "stlHis";
                lst.appendChild(titleElement);
                lst.appendChild(ul);
                var tgl = false; 
                lst.addEventListener('click', function() {
                    if (!tgl) {
                        lst.style.height = 'auto'
                        ul.style.display = 'block';
                        tgl = true;
                    } else {
                        ul.style.display = 'none';
                        lst.style.height = '2.3vw'
                        tgl = false;
                    }
                });
                LocalHis.appendChild(lst);
            }
        }
    });
}

function callrHis() {
    LocalHis.innerHTML = "";
    fetch(backendURL + "/viewHis2")
        .then((response) => response.json())
        .then((data) => smallHis(data))
        .catch((error) => console.error(error));
}

callrHis();

function displayPartList(parts) {
    parts.forEach(parts => {
        parts.sum = "";
    });
    // Extract user, worksite, floor, and unit values from the received data
    extractUserInfo(parts);

    const filteredData = parts.filter(part => !isEmptyPart(part) && !isBlackPart(part));

    if (filteredData.length === 0) {
        partListContainer.innerHTML = "No matching parts found.";
        return;
    }

    let lastRand;
    let currentUnitList = null;
    let uniqueID;
    var boxLen = 0;
    var tmp = {};
    let oldun = "";
    let restrict;
    var bnbr = 1000;
    dict = [];
    if (groupSort) {
        filteredData.reverse().forEach(part => {
        if (lastRand !== part.rand) {
            uniqueID = generateUniqueID();
            if (firstL === 1) {
                currentUnitList = createNewUnitList2(part, uniqueID);
            } else {
                currentUnitList = createNewUnitList2(part, uniqueID);
            }
            lastRand = part.rand;
            boxLen = 0;
        }
        boxLen += 1;
        if (oldun === "") {
            oldun = uniqueID
        }
        if (uniqueID == oldun) {
        } else {
            dict.push(tmp);
        }
        tmp = {[uniqueID]: boxLen};
        oldun = uniqueID
        part.uniqueID = uniqueID;
        const partItem = createPartItem(part);
        currentUnitList.appendChild(partItem);
    });
    firstL = 0;
    } else if (unitSort) {
        filteredData.reverse().forEach(part => {
        if (lastRand !== part.unit) {
            uniqueID = generateUniqueID();
            currentUnitList = createNewUnitList2(part, uniqueID);
            lastRand = part.unit;
            boxLen = 0;
        }
        boxLen += 1;
        if (oldun === "") {
            oldun = uniqueID
        }
        if (uniqueID == oldun) {
        } else {
            dict.push(tmp);
        }
        tmp = {[uniqueID]: boxLen};
        oldun = uniqueID
        part.uniqueID = uniqueID;
        const partItem = createPartItem(part);
        currentUnitList.appendChild(partItem);
    });
    } else {
        partListContainer.innerHTML = ""
        filteredData.forEach(part => {
        if (bnbr >= nbr) {
            uniqueID = generateUniqueID();
            currentUnitList = createNewUnitList2(part, uniqueID);
            bnbr = 0;
            boxLen = 0;
        }
        bnbr += 1;
        oldbox = boxLen;
        boxLen += 1;
        if (oldun === "") {
            oldun = uniqueID
        }
        if (uniqueID == oldun) {
        } else {
            dict.push(tmp);
        }
        tmp = {[uniqueID]: boxLen};
        oldun = uniqueID
        part.uniqueID = uniqueID;
        const partItem = createPartItem(part);
        currentUnitList.appendChild(partItem);
    });
    }
    document.getElementById("Norder").textContent = "Quantity: " + document.querySelectorAll('.part-item').length;
    nsheet.forEach(sheet => {
        let li = document.createElement("li");
        li.className = 'Numb';
        li.textContent = `${sheet.type} ${sheet.thickness} ${sheet.length}ft: ${sheet.count}`;
        document.getElementById("Nsheet").appendChild(li);
    });
    dict.push(tmp);
    dict2 = dict.reduce((acc, curr) => {
        return {...acc, ...curr};
    }, {});
}

        function isBlackPart(part) {
            for (const key in part) {
                if (part[key].trim() === "black") {
                    return true;
                }
            }
            return false;
        }

        function handleDelete(part, partItem) {
        const url = backendURL + "/delCart";
        const requestOptions = {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(part),
        };

        fetch(url, requestOptions)
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                // We expect an empty response, so no need to parse JSON
                return;
            })
            .then(() => {
                removeDeletedPart(partItem); // Pass the partItem
            })
            .catch((error) => console.error("Error deleting part:", error));
    }

    function removeDeletedPart(partItem) {
        partListContainer.removeChild(partItem);
    }
    var uniqueNewData = [];
function fetchAndDisplayData() {
    fetch(backendURL + "/getOrders")
    .then((response) => response.json())
    .then((data) => {
        var passNoti = true;
        data = data.filter(item => item.worksite === Cinfo.worksite);
        if (savedDataNotif.length !== 0 && savedDataNotif[0].worksite !== data[0].worksite) {
            passNoti = false;
        }
         if (passNoti && data.length > savedDataNotif.length) {
            const difference = data.length - savedDataNotif.length;
            const newElements = data.slice(0, difference);
            if (savedDataNotif.length > 0) {
                notifPanel(newElements);
            }
        }
        savedDataNotif = data;
        if (autoFetch && document.getElementById('MidLay3').style.display === '') {
            while (ulll.children.length > 1) {
                ulll.removeChild(ulll.children[1]);
            }
            nsheet = [];
            if (floorCh) {
                data = data.filter(item => item.floor === Cinfo.floor);
            }
            if (!data) {
                document.getElementById('MidLay1').style.display = 'none';
                document.getElementById('MidLay2').style.display = 'flex';
                return
            } else {
                document.getElementById('MidLay1').style.display = 'flex';
                document.getElementById('MidLay2').style.display = 'none';
            }
            if (data.length > savedData.length) {
                const difference = data.length - savedData.length;
                const newElements = data.slice(0, difference);
                displayPartList(newElements);
                savedData = data;
            }
        }
    })
    .catch((error) => console.error(error));
}
setInterval(fetchAndDisplayData, 10000);

//_____________________________________________________________________________________________________________________
//Right Logic
    const MidLay3 = document.getElementById("MidLay3");
    document.getElementById('changeUrlBtn').addEventListener('click', function() {
        let lastS;
        if (document.getElementById('MidLay1').style.display === 'flex') {
            lastS = 'MidLay1';
        } else if (document.getElementById('MidLay2').style.display === 'flex') {
            lastS = 'MidLay2';
        }
        if (document.getElementById('MidLay3').style.display === '') {
            fetch(backendURL + "/viewHis2")
            .then((response) => response.json())
            .then((data) => displayModPartList(data))
            .catch((error) => console.error(error));
            document.getElementById('changeUrlBtn').style.border = '0.25vw solid green';
            document.getElementById(lastS).style.display = 'none';
            document.getElementById('MidLay3').style.display = 'flex';
        } else if (document.getElementById('MidLay3').style.display === 'flex') {
            document.getElementById('changeUrlBtn').style.border = 'none';
            document.getElementById('MidLay3').style.display = '';
            document.getElementById('MidLay1').style.display = 'flex';
            apB.click();
        }
    });
    function generateModPartId(part) {
            return part.modPart;
        }
        function isEmptyModPart(part) {
            return (
                part.dA === "" &&
                part.dB === "" &&
                part.dC === "" &&
                part.dD === "" &&
                part.dE === "" &&
                part.dH === "" &&
                part.dR === "" &&
                part.dR_P === "" &&
                part.dW === ""
            );
        }
        function createModPartItem(part) {           
            const partItem = document.createElement("div");
            partItem.setAttribute('data-part-data', JSON.stringify(part));
            partItem.classList.add("modpart-item");
            const container = document.createElement("div");
            container.style.display = 'flex';
            const title = partTitles[part.part] || part.part;
            const title2 = part.unit;
            const h2 = document.createElement("h2");
            const h22 = document.createElement("h2");
            const h2222 = document.createElement("h2");
            const separ1 = document.createElement("h2");
            const separ2 = document.createElement("h2");
            const separ3 = document.createElement("h2");
            h2.textContent = title;
            h22.textContent = title2;
            h2222.textContent = part.floor;
            separ1.textContent = '|';
            separ2.textContent = '|';
            separ3.textContent = '|';
            h2.setAttribute('data-part-name', title);
            h2.style.marginRight = '0.4vw';
            h2222.style.marginRight = '0.4vw';
            h22.style.marginRight = '0.4vw';
            separ1.style.marginRight = '0.4vw';
            separ2.style.marginRight = '0.4vw';
            separ3.style.marginRight = '0.4vw';
            separ1.style.color = '#1E90FF';
            separ2.style.color = '#1E90FF';
            separ3.style.color = '#1E90FF';
            container.appendChild(h2);
            container.appendChild(separ1);
            container.appendChild(h2222);
            container.appendChild(separ2);
            container.appendChild(h22);
            container.appendChild(separ3);
            partItem.appendChild(container);
            const contentWrapper = document.createElement('div'); 
            contentWrapper.className = 'contentWrapper';          
            const ul = document.createElement("ul");
            ul.classList.add("modpart-item");
            ul.style.border = 'none'
            // Display part's properties
            const propertiesToDisplay = [
                'checktime',
                'time',
                'type',
                'side',
                'thickness',
                'length',
                'dA',
                'dB',
                'dC',
                'dD',
                'dE',
                'd1A',
                'd2A',
                'd1B',
                'd2B',
                'dR',
                'dR_P',
                'dH',
                'dW',
                'edgeA',
                'edgeB',
                'note',
            ];
            let isFirstItem = true;
            propertiesToDisplay.forEach(propKey => {
                if (part[propKey] && part[propKey].trim() !== "") {
                    const li = document.createElement("li");
                    li.textContent = `${propKey[0].toUpperCase() + propKey.slice(1)}: ${part[propKey]}`;
                    if (isFirstItem) {
                        li.style.marginTop = "2vw";
                        isFirstItem = false;
                    }
                    li.style.marginLeft = "2vw";
                    ul.appendChild(li);
                }
            });
            contentWrapper.appendChild(ul);
            const partInfo = partData[part.part];
            if (partInfo && partInfo.imageUrl) {
                const img = document.createElement("img");
                img.src = partInfo.imageUrl;
                img.alt = partInfo.title || 'Part Image';
                img.style.width = "40%";
                img.style.height = "40%";
                contentWrapper.appendChild(img);
            }
            partItem.appendChild(contentWrapper);
            container.addEventListener("click", function() {
                if (contentWrapper.style.display === 'none' || contentWrapper.style.display === '') {
                contentWrapper.style.display = 'flex';
                contentWrapper.querySelector('.modpart-item').style.display = 'block'; 
            } else {
                contentWrapper.style.display = 'none';
                contentWrapper.querySelector('.modpart-item').style.display = 'none';
            }
        });
            const deleteButton = document.createElement("button");
            deleteButton.textContent = "Retrieve Part";
            deleteButton.addEventListener("click", () => {
                const userConfirmed = window.confirm("Are you sure you want to retrieve that part?");  
                if (userConfirmed) {
                    handleModRetrieve(part, partItem);
                } else {
                    console.log('User declined');
                }
            });
            partItem.appendChild(deleteButton);

            partItem.setAttribute("data-part-id", generateModPartId(part)); // Set data-part-id attribute
            return partItem;
    }
    let modUserValue = "";
        let modWorksiteValue = "";
        let modFloorValue = "";
        let modUnitValue = "";
    function extractModUserInfo(data) {
    if (data.length > 0) {
        userValue = data[0].user || "";   // Set default value if 'user' is not present
        worksiteValue = data[0].worksite || "";   // Set default value if 'worksite' is not present
        floorValue = data[0].floor || "";   // Set default value if 'floor' is not present
        unitValue = data[0].unit || "";   // Set default value if 'unit' is not present
    }
}
    function displayModPartList(parts) {
        parts = parts.filter(item => item.worksite === Cinfo.worksite);
        if (floorCh) {
            parts = parts.filter(item => item.floor === Cinfo.floor);
        }
        MidLay3.innerHTML = "";
        extractModUserInfo(parts);
        const filteredData = parts.filter(part => !isEmptyModPart(part) && !isBlackModPart(part));
        if (filteredData.length === 0) {
            MidLay3.innerHTML = "No matching parts found.";
            return;
        }
        filteredData.reverse().forEach(part => {
            const partItem = createModPartItem(part);
            MidLay3.appendChild(partItem);
        });
    }
        function isBlackModPart(part) {
            for (const key in part) {
                if (part[key].trim() === "black") {
                    return true;
                }
            }
            return false;
        }
        function handleModRetrieve(part, partItem) {
            const url = backendURL + "/retreiveHis";
            const requestOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(part),
            };

            fetch(url, requestOptions)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok");
                    }
                    return;
                })
                .then(() => {
                    partItem.remove();
                    alert('Part Retrieved');
                })
                .catch((error) => console.error("Error deleting part:", error));
    }
        </script>
</body>
</html>
